<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Safe Routes & Construction Analysis — Orbital Coms</title>

  <!-- Local styles -->
  <link rel="stylesheet" href="css/rutas.css" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

  <!-- TOPBAR -->
  <div id="topbar">
    <h1>🛣️ SAFE ROUTES & CONSTRUCTION ANALYSIS</h1>

    <div id="controls">
      <label for="date">Quick Date:</label>
      <input id="date" type="date" />
      <button id="goDate" class="btn secondary" title="Apply date to layers">Apply</button>
      <a href="map.html" class="btn" title="Back to main map">← Main Map</a>
    </div>
  </div>

  <!-- CONTROL PANEL (LEFT SIDE) -->
  <div id="controlPanel" class="visible">
    <div class="panel-header">
      <h2>Analysis Control Panel</h2>
      <div class="panel-header-buttons">
        <button id="minimizeControl" class="minimizeBtn" title="Minimize">−</button>
        <button id="closeControl" class="closeBtn" title="Close">×</button>
      </div>
    </div>

    <div class="panel-content">

    <!-- SEARCH LOCATION -->
    <div class="control-section">
      <label class="control-label">📍 Search Location</label>
      <div class="search-wrapper">
        <input 
          type="text" 
          id="searchLocation" 
          placeholder="City name or coordinates (lat, lon)..."
          class="search-input"
        />
        <div id="searchResults" class="search-results"></div>
      </div>
      <small class="help-text">Example: Piura, Peru or -5.2, -80.6</small>
    </div>

    <!-- DATE RANGE -->
    <div class="control-section">
      <label class="control-label">📅 Analysis Period</label>
      <div class="date-range-grid">
        <div class="date-input-group">
          <label for="dateStart">From:</label>
          <input type="date" id="dateStart" class="date-input" />
        </div>
        <div class="date-input-group">
          <label for="dateEnd">To:</label>
          <input type="date" id="dateEnd" class="date-input" />
        </div>
      </div>
    </div>

    <!-- ANALYSIS MODE -->
    <div class="control-section">
      <label class="control-label">🔬 Analysis Mode</label>
      <div class="mode-selector">
        <label class="mode-option">
          <input type="radio" name="analysisMode" id="modeRoute" value="route" checked />
          <span class="mode-content">
            <span class="mode-icon">🛣️</span>
            <span class="mode-title">Safe Route</span>
            <span class="mode-desc">Is it safe to travel?</span>
          </span>
        </label>
        <label class="mode-option">
          <input type="radio" name="analysisMode" id="modeConstruction" value="construction" />
          <span class="mode-content">
            <span class="mode-icon">🏗️</span>
            <span class="mode-title">Construction</span>
            <span class="mode-desc">Can I build here?</span>
          </span>
        </label>
      </div>
    </div>

    <!-- PROCESS BUTTON -->
    <button id="btnProcess" class="btn-process">
      🚀 Process Analysis
    </button>

    <!-- LAYER TOGGLES -->
    <div class="control-section">
      <label class="control-label">Map Overlays</label>
      <div class="layer-toggles">
        <button id="btnToggleCities" class="btn-toggle">Cities</button>
        <button id="btnToggleSST" class="btn-toggle">SST</button>
        <button id="btnToggleIMERG" class="btn-toggle">IMERG</button>
      </div>
    </div>

    <!-- EXPLORATION MODE TOGGLE -->
    <div class="control-section">
      <label class="control-label">Map Interaction</label>
      <button id="btnExplorationMode" class="btn-exploration">
        Exploration OFF
      </button>
      <small class="help-text">Enable to mark custom points on maps</small>
    </div>
    </div> <!-- End panel-content -->
  </div> <!-- End controlPanel -->

  <!-- TWO STACKED MAPS -->
  <div id="mapsWrapper">
    <!-- TOP MAP: Current Climate Visualization -->
    <div class="map-container">
      <div class="map-label">🌍 Current Climate Data (NASA GIBS)</div>
      <div id="mapRoutes" aria-label="Climate data visualization map"></div>
    </div>

    <!-- BOTTOM MAP: Analysis Results -->
    <div class="map-container">
      <div class="map-label">📊 Analysis Results</div>
      <div id="mapBuild" aria-label="Analysis results map"></div>
    </div>
  </div>

  <!-- SST LEGEND -->
  <div class="legendSmall" id="legendSmall">
    <div class="legend-title">🌡️ SST Anomalies</div>
    <div class="legend-row">
      <div class="colorBox" style="background: linear-gradient(90deg,#0000ff,#00ffff)"></div>
      <span>Cooling</span>
    </div>
    <div class="legend-row">
      <div class="colorBox" style="background: linear-gradient(90deg,#ffff00,#ff9800)"></div>
      <span>Neutral</span>
    </div>
    <div class="legend-row">
      <div class="colorBox" style="background: linear-gradient(90deg,#ff5722,#d500f9)"></div>
      <span>Warming</span>
    </div>
    <div class="legend-footer">Red = El Niño</div>
  </div>

  <!-- RESULTS PANEL (RIGHT) -->
  <div id="resultPanel">
    <button id="closeResults" class="closeBtn" aria-label="Close results">×</button>
    <div id="resultsContent">
      <div class="empty-state">
        <div class="empty-icon">📊</div>
        <h3>No Analysis Yet</h3>
        <p>Search for a location, select dates and mode, then click "Process Analysis" to see results here.</p>
      </div>
    </div>
  </div>

  <!-- INFO COORDINATES -->
  <div id="info" class="infoPane">
    <strong>📍 Coordinates</strong>
    <div id="coords">Click on map or search location</div>
    <hr style="margin:8px 0; border:none; border-top:1px solid #ddd;">
    <div id="layerInfo">System: NASA GIBS + Esri</div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <script src="rutas.js"></script>

</body>
</html>