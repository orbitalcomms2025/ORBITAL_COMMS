<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Visualizador Climático Piura — Monitoreo El Niño</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Sistema de monitoreo climático para Piura con datos NASA GIBS - Anomalías SST y predicción El Niño">
<link rel="stylesheet" href="css/map.css" />

<!-- Librerías externas -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
</head>
<body>

<!-- TOPBAR -->
<div id="topbar">
  <h1>🌊 Visualizador Climático Piura</h1>
  <div id="controls">
    <label for="date">Fecha:</label>
    <input id="date" type="date" />
    <button id="goDate" class="btn secondary">Aplicar</button>
    <button id="fitPeru" class="btn">Perú</button>
    <button id="fitPiura" class="btn">Piura</button>

    <div class="tabsControl">
      <button class="tabBtn active" data-tab="fenomenoPane">El Niño 2019</button>
      <button class="tabBtn" data-tab="prediccionPane">Predicción</button>
      <button id="togglePanel" class="btn" title="Mostrar/Ocultar capas">⚙️ Capas</button>
    </div>
  </div>
</div>

<!-- MAPA -->
<div id="map"></div>

<!-- INFO PANE (COORDENADAS) -->
<div id="info" class="infoPane" style="display:block;">
  <strong>📍 Coordenadas</strong>
  <div id="coords">Haz clic en el mapa</div>
  <hr style="margin:8px 0; border:none; border-top:1px solid #ddd;">
  <div id="layerInfo">Sistema: NASA GIBS + Esri</div>
</div>

<!-- PESTAÑA: FENÓMENO NIÑO 2019 -->
<div id="fenomenoPane" class="tabContent" style="display:block;">
  <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px;">
    <img src="https://cdn-icons-png.flaticon.com/512/1995/1995530.png" alt="Info" style="width:40px; height:40px;">
    <h3 style="margin:0; border:none; padding:0;">Fenómeno El Niño 2019</h3>
  </div>
  
  <p style="line-height:1.6;">El Fenómeno del Niño 2019 impactó severamente la región norte del Perú con lluvias intensas, inundaciones y huaicos que afectaron infraestructura crítica y actividad agrícola.</p>
  
  <div style="display:flex; gap:12px; margin:16px 0; flex-wrap:wrap;">
    <div style="flex:1; min-width:140px; background:#f8f9fa; padding:10px; border-radius:8px; border-left:4px solid #3498db;">
      <h4 style="margin:0 0 6px 0; color:#3498db; font-size:13px;">💧 LLUVIAS</h4>
      <div style="background:#e3f2fd; height:8px; border-radius:4px; overflow:hidden; margin-bottom:6px;">
        <div style="width:85%; height:100%; background:#3498db;"></div>
      </div>
      <p style="margin:0; font-size:12px; color:#555;">Máximo: <strong>420 mm</strong> (marzo)</p>
    </div>
    
    <div style="flex:1; min-width:140px; background:#f8f9fa; padding:10px; border-radius:8px; border-left:4px solid #e74c3c;">
      <h4 style="margin:0 0 6px 0; color:#e74c3c; font-size:13px;">🏠 INUNDACIONES</h4>
      <div style="background:#ffebee; height:8px; border-radius:4px; overflow:hidden; margin-bottom:6px;">
        <div style="width:65%; height:100%; background:#e74c3c;"></div>
      </div>
      <p style="margin:0; font-size:12px; color:#555;">Afectados: <strong>+50,000</strong> personas</p>
    </div>
    
    <div style="flex:1; min-width:140px; background:#f8f9fa; padding:10px; border-radius:8px; border-left:4px solid #f39c12;">
      <h4 style="margin:0 0 6px 0; color:#f39c12; font-size:13px;">⚠️ HUAICOS</h4>
      <div style="background:#fff3e0; height:8px; border-radius:4px; overflow:hidden; margin-bottom:6px;">
        <div style="width:40%; height:100%; background:#f39c12;"></div>
      </div>
      <p style="margin:0; font-size:12px; color:#555;">Quebradas: <strong>+12</strong> colapsadas</p>
    </div>
  </div>

  <h4 style="margin:16px 0 8px 0; color:#111;">📊 Precipitación mensual</h4>
  <canvas id="rainChart" width="360" height="140" style="background:#fff; border-radius:8px; padding:4px;"></canvas>

  <h4 style="margin:16px 0 8px 0; color:#111;">🌾 Impacto agrícola</h4>
  <p style="margin:4px 0 8px 0; font-size:13px; line-height:1.5;">Reducción significativa en producción de cultivos principales:</p>
  <canvas id="cropChart" width="360" height="140" style="background:#fff; border-radius:8px; padding:4px;"></canvas>

  <div style="background:#fff3cd; padding:12px; border-radius:8px; border-left:4px solid #f39c12; margin-top:16px;">
    <strong style="color:#856404; display:block; margin-bottom:8px;">🔍 Datos clave:</strong>
    <ul style="margin:0; padding-left:20px; font-size:13px; line-height:1.8; color:#856404;">
      <li><strong>Inicio:</strong> Enero 2019</li>
      <li><strong>Pico máximo:</strong> Marzo 2019</li>
      <li><strong>Regiones críticas:</strong> Piura, Tumbes, Lambayeque</li>
      <li><strong>Daño económico:</strong> +150 millones USD</li>
      <li><strong>Reducción agrícola:</strong> ~30% promedio</li>
    </ul>
  </div>
</div>

<!-- PESTAÑA: PREDICCIÓN -->
<div id="prediccionPane" class="tabContent">
  <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px;">
    <img src="https://cdn-icons-png.flaticon.com/512/254/254032.png" alt="Predicción" style="width:40px; height:40px;">
    <h3 style="margin:0;">Predicción y Zonas de Riesgo</h3>
  </div>
  
  <p style="line-height:1.6;">Sistema predictivo basado en datos históricos y modelos climáticos para identificar zonas vulnerables ante eventos extremos.</p>
  
  <div style="background:#e8f5e9; padding:12px; border-radius:8px; border-left:4px solid #4caf50; margin-top:12px;">
    <strong style="color:#2e7d32; display:block; margin-bottom:6px;">✅ Funcionalidades:</strong>
    <ul style="margin:0; padding-left:20px; font-size:13px; line-height:1.8; color:#2e7d32;">
      <li>Haz clic en el mapa para ver predicciones por zona</li>
      <li>Visualización de mapas de calor de riesgo</li>
      <li>Recomendaciones específicas por región</li>
      <li>Probabilidad de eventos extremos</li>
    </ul>
  </div>
  
  <div style="background:#fff3e0; padding:12px; border-radius:8px; border-left:4px solid #ff9800; margin-top:12px;">
    <strong style="color:#e65100;">⚠️ Nota:</strong>
    <p style="margin:6px 0 0 0; font-size:13px; color:#e65100; line-height:1.5;">
      Las predicciones se basan en modelos estadísticos y deben complementarse con información oficial de SENAMHI.
    </p>
  </div>
</div>

<!-- LEYENDA SST -->
<div class="legendPane">
  <strong>🌡️ Anomalías SST</strong>
  <div><span class="color-box" style="background:linear-gradient(90deg, #0000ff, #00ffff);"></span>Enfriamiento</div>
  <div><span class="color-box" style="background:linear-gradient(90deg, #ffff00, #ff9800);"></span>Neutro</div>
  <div><span class="color-box" style="background:linear-gradient(90deg, #ff5722, #d500f9);"></span>Calentamiento</div>
  <p style="margin:8px 0 0 0; font-size:11px; color:#666; line-height:1.4;">
    Rojo/Magenta = El Niño activo
  </p>
</div>

<!-- PANEL DE CAPAS ARRASTRABLE -->
<div id="layerPanel" aria-hidden="false">
  <div class="panelHeader">
    <span>🗺️ Capas del Mapa</span>
    <button id="closePanel" style="background:none;border:none;cursor:pointer;font-size:20px;color:#111;" aria-label="Cerrar panel">×</button>
  </div>
  <div id="layerList">
    <!-- Las capas se generan dinámicamente desde JavaScript -->
  </div>
  <div class="panelFooter">
    <button id="resetLayers" class="btn" style="font-size:13px;">🔄 Resetear capas</button>
  </div>
</div>

<!-- Script principal -->
<script src="map.js"></script>
</body>
</html>