<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Orbital Coms — El Niño Monitoring System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Climate monitoring system for Piura with NASA GIBS data - SST Anomalies and El Niño prediction">
<link rel="stylesheet" href="../css/map.css" />

<!-- External libraries -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
</head>
<body>

<!-- TOPBAR -->
<div id="topbar">
  <h1>🌊 ORBITAL COMS MAP</h1>
  <div id="controls">
    <label for="date">Date:</label>
    <input id="date" type="date" />
    <button id="goDate" class="btn secondary">Apply</button>
    <button id="fitPeru" class="btn">Peru</button>
    <button id="fitPiura" class="btn">Piura</button>
  </div>
</div>

<!-- MAP -->
<div id="map"></div>

<!-- INITIAL TUTORIAL -->
<div id="initialTutorial" class="tutorial-overlay">
  <div class="tutorial-content">
    <h2>Welcome to Piura Climate Viewer</h2>
    <p>Interactive platform for monitoring El Niño phenomenon and climate predictions</p>
    <div class="tutorial-steps">
      <div class="tutorial-step">
        <span class="step-icon">🗺️</span>
        <h3>Map Layers</h3>
        <p>Click <strong>LAYERS</strong> tab on the right to toggle satellite imagery, SST data, and heatmaps</p>
      </div>
      <div class="tutorial-step">
        <span class="step-icon">🌡️</span>
        <h3>SST Animation</h3>
        <p>Use <strong>SST TIMELINE</strong> button at bottom to visualize ocean temperature changes over time</p>
      </div>
      <div class="tutorial-step">
        <span class="step-icon">📊</span>
        <h3>Information Panels</h3>
        <p>Access <strong>EL NIÑO</strong> and <strong>FORECAST</strong> tabs for detailed analysis and predictions</p>
      </div>
      <div class="tutorial-step">
        <span class="step-icon">🔍</span>
        <h3>Search & Click</h3>
        <p>Search locations at top or click on map zones to get risk predictions</p>
      </div>
    </div>
    <button id="closeTutorial" class="btn-tutorial">Got it! Start Exploring</button>
  </div>
</div>

<!-- INFO PANE (COORDINATES) -->
<div id="info" class="infoPane" style="display:block;">
  <strong>📍 Coordinates</strong>
  <div id="coords">Click on the map</div>
  <hr style="margin:8px 0; border:none; border-top:1px solid #ddd;">
  <div id="layerInfo">System: NASA GIBS + Esri</div>
</div>

<!-- TAB: EL NIÑO 2019 -->
<div id="fenomenoPane" class="tabContent" aria-hidden="true">
  <button class="closeTabContent">×</button>
  <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px;">
    <img src="https://cdn-icons-png.flaticon.com/512/1995/1995530.png" alt="Info" style="width:40px; height:40px;">
    <h3 style="margin:0; border:none; padding:0;">El Niño Phenomenon 2019</h3>
  </div>
  
  <p style="line-height:1.6;">The 2019 El Niño event severely impacted northern Peru with intense rainfall, floods, and landslides affecting critical infrastructure and agriculture.</p>
  
  <div style="display:flex; gap:12px; margin:16px 0; flex-wrap:wrap;">
    <div style="flex:1; min-width:140px; background:#f8f9fa; padding:10px; border-radius:8px; border-left:4px solid #3498db;">
      <h4 style="margin:0 0 6px 0; color:#3498db; font-size:13px;">💧 RAINFALL</h4>
      <div style="background:#e3f2fd; height:8px; border-radius:4px; overflow:hidden; margin-bottom:6px;">
        <div style="width:85%; height:100%; background:#3498db;"></div>
      </div>
      <p style="margin:0; font-size:12px; color:#555;">Peak: <strong>420 mm</strong> (March)</p>
    </div>
    
    <div style="flex:1; min-width:140px; background:#f8f9fa; padding:10px; border-radius:8px; border-left:4px solid #e74c3c;">
      <h4 style="margin:0 0 6px 0; color:#e74c3c; font-size:13px;">🏠 FLOODS</h4>
      <div style="background:#ffebee; height:8px; border-radius:4px; overflow:hidden; margin-bottom:6px;">
        <div style="width:65%; height:100%; background:#e74c3c;"></div>
      </div>
      <p style="margin:0; font-size:12px; color:#555;">Affected: <strong>+50,000</strong> people</p>
    </div>
    
    <div style="flex:1; min-width:140px; background:#f8f9fa; padding:10px; border-radius:8px; border-left:4px solid #f39c12;">
      <h4 style="margin:0 0 6px 0; color:#f39c12; font-size:13px;">⚠️ LANDSLIDES</h4>
      <div style="background:#fff3e0; height:8px; border-radius:4px; overflow:hidden; margin-bottom:6px;">
        <div style="width:40%; height:100%; background:#f39c12;"></div>
      </div>
      <p style="margin:0; font-size:12px; color:#555;">Ravines: <strong>+12</strong> collapsed</p>
    </div>
  </div>

  <h4 style="margin:16px 0 8px 0; color:#111;">📊 Monthly Precipitation</h4>
  <canvas id="rainChart" width="360" height="140" style="background:#fff; border-radius:8px; padding:4px;"></canvas>

  <h4 style="margin:16px 0 8px 0; color:#111;">🌾 Agricultural Impact</h4>
  <p style="margin:4px 0 8px 0; font-size:13px; line-height:1.5;">Significant reduction in main crop production:</p>
  <canvas id="cropChart" width="360" height="140" style="background:#fff; border-radius:8px; padding:4px;"></canvas>

  <div style="background:#fff3cd; padding:12px; border-radius:8px; border-left:4px solid #f39c12; margin-top:16px;">
    <strong style="color:#856404; display:block; margin-bottom:8px;">🔍 Key Data:</strong>
    <ul style="margin:0; padding-left:20px; font-size:13px; line-height:1.8; color:#856404;">
      <li><strong>Start:</strong> January 2019</li>
      <li><strong>Peak:</strong> March 2019</li>
      <li><strong>Critical regions:</strong> Piura, Tumbes, Lambayeque</li>
      <li><strong>Economic damage:</strong> +150 million USD</li>
      <li><strong>Agricultural reduction:</strong> ~30% average</li>
    </ul>
  </div>
</div>

<!-- TAB: PREDICTIONS -->
<div id="prediccionPane" class="tabContent" aria-hidden="true">
  <button class="closeTabContent">×</button>
  <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px;">
    <img src="https://cdn-icons-png.flaticon.com/512/254/254032.png" alt="Prediction" style="width:40px; height:40px;">
    <h3 style="margin:0;">Prediction & Risk Zones</h3>
  </div>
  
  <p style="line-height:1.6;">Predictive system based on historical data and climate models to identify vulnerable zones to extreme events.</p>
  
  <div style="background:#e8f5e9; padding:12px; border-radius:8px; border-left:4px solid #4caf50; margin-top:12px;">
    <strong style="color:#2e7d32; display:block; margin-bottom:6px;">✅ Features:</strong>
    <ul style="margin:0; padding-left:20px; font-size:13px; line-height:1.8; color:#2e7d32;">
      <li>Click on map to see zone predictions</li>
      <li>Risk heatmap visualization</li>
      <li>Region-specific recommendations</li>
      <li>Extreme event probabilities</li>
    </ul>
  </div>
  
  <div style="background:#fff3e0; padding:12px; border-radius:8px; border-left:4px solid #ff9800; margin-top:12px;">
    <strong style="color:#e65100;">⚠️ Note:</strong>
    <p style="margin:6px 0 0 0; font-size:13px; color:#e65100; line-height:1.5;">
      Predictions are based on statistical models and should be complemented with official SENAMHI information.
    </p>
  </div>
</div>

<!-- SST LEGEND -->
<div class="legendPane">
  <strong>🌡️ SST Anomalies</strong>
  <div><span class="color-box" style="background:linear-gradient(90deg, #0000ff, #00ffff);"></span>Cooling</div>
  <div><span class="color-box" style="background:linear-gradient(90deg, #ffff00, #ff9800);"></span>Neutral</div>
  <div><span class="color-box" style="background:linear-gradient(90deg, #ff5722, #d500f9);"></span>Warming</div>
  <p style="margin:8px 0 0 0; font-size:11px; color:#666; line-height:1.4;">
    Red/Magenta = Active El Niño
  </p>
</div>

<!-- LAYERS PANEL (Draggable) -->
<div id="layerPanel" aria-hidden="true">
  <div class="panelHeader">
    <span>🗺️ Map Layers</span>
    <button id="closePanel" style="background:none;border:none;cursor:pointer;font-size:20px;color:#111;" aria-label="Close panel">×</button>
  </div>
  <div id="layerList">
    <!-- Layers generated dynamically from JavaScript -->
  </div>
  <div class="panelFooter">
    <button id="resetLayers" class="btn" style="font-size:13px;">🔄 Reset Layers</button>
  </div>
</div>

<!-- Main script -->
<script src="map.js"></script>
</body>
</html>
