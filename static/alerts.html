<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real-Time Global Alerts</title>
<link rel="icon" href="../assets/images/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="./assets/images/favicon.ico" type="image/x-icon">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<meta name="description" content="Orbital Comms: Real-time information on natural disasters for effective response and preparedness">
<meta name="author" content="Orbital Comms Team">
<meta name="theme-color" content="#00FFEA"> 
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: white;
}
header {
  background: rgba(0,0,0,0.7);
  padding: 1rem;
  text-align: center;
}
header h1 { margin:0; font-size:2rem; color:#ffcc00; }
main {
  padding: 1rem;
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(320px,1fr));
  gap: 1rem;
}
.card {
  background: rgba(255,255,255,0.1);
  border-radius: 12px;
  padding: 1rem;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  transition: transform 0.2s ease-in-out;
}
.card:hover { transform: scale(1.02); }
h3 { margin-top:0; color:#00eaff; }
small { color:#ccc; }

/* ===== SEARCH BAR ===== */
#search-container {
  padding: 1rem;
  text-align: center;
}
#search-input {
  width: 80%;
  max-width: 400px;
  padding: 10px 15px;
  border-radius: 10px;
  border: none;
  outline: none;
  font-size: 1rem;
  background: rgba(255,255,255,0.1);
  color: #fff;
  box-shadow: inset 0 0 5px rgba(0,255,234,0.2);
}
#search-input::placeholder {
  color: #ccc;
}
</style>
</head>
<body>
<header>
  <h1>üåç Real-Time Global Alerts</h1>
  <p>Earthquakes, Fires, and Natural Disasters</p>
</header>

<!-- SEARCH BAR -->
<div id="search-container">
  <input type="text" id="search-input" placeholder="Search by city or country...">
</div>

<main id="alerts-container">
  <p>Loading alerts...</p>
</main>

<script>
// Contenedor principal
const contenedor = document.getElementById("alerts-container");
const searchInput = document.getElementById("search-input");

// üîπ Function to load earthquakes USGS
async function loadEarthquakes() {
  try {
    const res = await fetch("https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson");
    const data = await res.json();
    return data.features.map(ev => ({
      type: "Earthquake",
      location: ev.properties.place,
      magnitude: ev.properties.mag,
      time: new Date(ev.properties.time).toLocaleString(),
      url: ev.properties.url
    }));
  } catch(e) { console.error(e); return []; }
}

// üîπ Function to load NASA FIRMS fires (last 24h)
async function loadFires() {
  try {
    const res = await fetch("https://firms.modaps.eosdis.nasa.gov/mapserver/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&typeNames=fires_modis_24h&outputFormat=application/json");
    const data = await res.json();
    return data.features.map(ev => ({
      type: "Fire",
      location: `${ev.properties.latitude.toFixed(2)}, ${ev.properties.longitude.toFixed(2)}`,
      intensity: ev.properties.brightness,
      time: new Date(ev.properties.acq_date + "T" + ev.properties.acq_time).toLocaleString()
    }));
  } catch(e) { console.error(e); return []; }
}

// üîπ Function to load GDACS disasters
async function loadGDACS() {
  try {
    const res = await fetch("https://www.gdacs.org/xml/rss.xml");
    const text = await res.text();
    const parser = new DOMParser();
    const xml = parser.parseFromString(text,"application/xml");
    const items = xml.querySelectorAll("item");
    const events = [];
    items.forEach(item => {
      events.push({
        type: item.querySelector("category")?.textContent || "Disaster",
        location: item.querySelector("title")?.textContent || "",
        time: item.querySelector("pubDate")?.textContent || "",
        link: item.querySelector("link")?.textContent || ""
      });
    });
    return events;
  } catch(e){ console.error(e); return []; }
}

// üîπ Function to render all alerts
let allAlerts = [];
async function loadGlobalAlerts() {
  contenedor.innerHTML = "<p>Loading alerts...</p>";
  const earthquakes = await loadEarthquakes();
  const fires = await loadFires();
  const gdacs = await loadGDACS();
  allAlerts = [...earthquakes, ...fires, ...gdacs];
  renderAlerts(allAlerts);
}

// üîπ Render function with optional filter
function renderAlerts(alerts) {
  if(alerts.length===0){
    contenedor.innerHTML="<p>‚úÖ No active alerts at this moment</p>";
    return;
  }
  contenedor.innerHTML="";
  alerts.forEach(ev => {
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML = `<h3>${ev.type}</h3>
                      <p><strong>Location:</strong> ${ev.location}</p>
                      ${ev.magnitude ? `<p><strong>Magnitude:</strong> ${ev.magnitude}</p>` : ""}
                      ${ev.intensity ? `<p><strong>Intensity:</strong> ${ev.intensity}</p>` : ""}
                      <p><small>‚è∞ ${ev.time}</small></p>
                      ${ev.url || ev.link ? `<p><a href="${ev.url||ev.link}" target="_blank" style="color:#ffcc00;">See more</a></p>` : ""}
                      `;
    contenedor.appendChild(card);
  });
}

// üîπ Search functionality
searchInput.addEventListener("input", () => {
  const query = searchInput.value.toLowerCase();
  const filtered = allAlerts.filter(ev => ev.location.toLowerCase().includes(query));
  renderAlerts(filtered);
});

// Load on start + every 10 minutes
loadGlobalAlerts();
setInterval(loadGlobalAlerts,600000);
</script>
</body>
</html>
